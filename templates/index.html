<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>Peľová Analýza Vegetácie v Trnave</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #05060a;
            --bg-elevated: #0b1020;
            --card: #111827;
            --border: #1f2937;
            --accent: #22c55e;
            --accent-soft: rgba(34, 197, 94, 0.12);
            --text: #e5e7eb;
            --muted: #9ca3af;
            --danger: #ef4444;
            --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at top, #020617 0, #020617 35%, #000 100%);
            color: var(--text); font-family: var(--font); min-height: 100vh;
        }
        .page { max-width: 1120px; margin: 0 auto; padding: 24px 16px 40px; }
        header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 8px 0 24px; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-mark {
            width: 28px; height: 28px; border-radius: 10px;
            background: conic-gradient(from 210deg, #22c55e, #4ade80, #22c55e);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 18px rgba(34, 197, 94, 0.55);
        }
        .logo-mark span { font-size: 16px; font-weight: 700; color: #020617; }
        .logo-text-main { font-size: 18px; font-weight: 600; letter-spacing: 0.03em; }
        .logo-text-sub { font-size: 11px; text-transform: uppercase; letter-spacing: 0.14em; color: var(--muted); }
        .tagline { font-size: 12px; color: var(--muted); text-align: right; }
        .tagline span { color: var(--accent); }

        .hero {
            border-radius: 18px;
            background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.16), transparent 55%),
                        radial-gradient(circle at top right, rgba(52, 211, 153, 0.08), transparent 60%),
                        var(--bg-elevated);
            border: 1px solid rgba(148, 163, 184, 0.14);
            padding: 22px 20px 18px;
            box-shadow: 0 18px 60px rgba(15, 23, 42, 0.75);
        }
        .hero-title { font-size: clamp(26px, 3.1vw, 32px); line-height: 1.1; font-weight: 650; margin-bottom: 8px; }
        .hero-highlight {
            display: inline-flex; align-items: center; gap: 8px; padding: 3px 9px;
            border-radius: 999px; background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(34, 197, 94, 0.45);
            font-size: 11px; text-transform: uppercase; letter-spacing: 0.14em;
            color: var(--muted); margin-bottom: 8px;
        }
        .hero-highlight-dot { width: 7px; height: 7px; border-radius: 999px; background: var(--accent); box-shadow: 0 0 10px rgba(34, 197, 94, 0.9); }
        .hero-subtitle { font-size: 13px; color: var(--muted); max-width: 600px; margin-bottom: 20px; line-height: 1.6; }
        .hero-controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 14px; }
        .control-group { display: flex; flex-direction: column; gap: 8px; font-size: 11px; color: var(--muted); }
        .control-group label { text-transform: uppercase; letter-spacing: 0.14em; }
        .control-input {
            display: flex; align-items: center; gap: 8px; padding: 7px 12px;
            background: rgba(15, 23, 42, 0.95); border-radius: 10px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            font-size: 13px; color: var(--text);
        }
        select, button {
            font-family: inherit; font-size: 13px; border: none;
            background: transparent; color: inherit; outline: none; width: 100%;
        }
        .year-checkbox-group {
            display: flex; flex-wrap: wrap; gap: 8px;
            padding: 8px; background: rgba(15, 23, 42, 0.95);
            border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.35);
            max-height: 120px; overflow-y: auto;
        }
        .year-checkbox { display: flex; align-items: center; }
        .year-checkbox input { display: none; }
        .year-checkbox label {
            padding: 6px 12px; border-radius: 8px; font-size: 12px;
            cursor: pointer; border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .year-checkbox input:checked + label {
            background: var(--accent-soft); color: var(--accent);
            border-color: rgba(34, 197, 94, 0.45);
        }
        #season-info {
            font-size: 11px; color: var(--muted); margin-top: 4px; padding-left: 5px; min-height: 1.2em;
        }
        .button-group { align-self: end; }
        button.primary {
            background: linear-gradient(125deg, #22c55e, #4ade80); color: #022c22;
            border-radius: 999px; padding: 12px 20px; font-weight: 600;
            letter-spacing: 0.04em; text-transform: uppercase; font-size: 12px;
            cursor: pointer; border: none; box-shadow: 0 15px 40px rgba(16, 185, 129, 0.35);
            transition: all 0.2s ease;
        }
        button.primary:hover { filter: brightness(1.1); transform: translateY(-1px); }
        button:disabled { cursor: not-allowed; background: var(--border); color: var(--muted); box-shadow: none; }

        .results-section {
            margin-top: 24px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 400px; background: var(--card); border-radius: 16px;
            border: 1px solid var(--border); padding: 20px;
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.85); text-align: center;
        }
        .results-section img { max-width: 100%; border-radius: 10px; border: 1px solid var(--border); }
        .placeholder-text { color: var(--muted); font-size: 14px; }
        .error-message {
            color: var(--danger); background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger); padding: 10px 15px;
            border-radius: 10px; max-width: 600px;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2); border-left-color: var(--accent);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .card {
            background: var(--card); border-radius: 16px; border: 1px solid var(--border);
            padding: 14px 14px 13px; margin-top: 24px;
        }
        .card-header { margin-bottom: 10px; }
        .card-title { font-size: 13px; text-transform: uppercase; letter-spacing: 0.16em; color: var(--muted); }
        .card-body p { font-size: 12px; color: var(--muted); line-height: 1.6; }
        .button-flexbox {
            display: flex; gap: 12px; margin-bottom: 16px;
        }
    </style>
</head>
<body>
<div class="page">
    <header>
        <div class="logo">
            <div class="logo-mark"><span>T</span></div>
            <div>
                <div class="logo-text-main">Peľová Analýza Trnavy</div>
                <div class="logo-text-sub">Sentinel-2 · NDVI Trendy</div>
            </div>
        </div>
        <div class="tagline">
            Analýza dlhodobých trendov vegetácie<br>
            <span>Spracované pomocou Sentinel Hub API</span>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-highlight">
                <div class="hero-highlight-dot"></div>
                <span>Trnava · Analýza peľových sezón</span>
            </div>
            <div class="button-flexbox">
                <button class="primary load-veg-btn">Zmena vegetácia</button>
                <button class="primary load-pollen-btn">Nástup peľovej sezóny</button>
            </div>
            <div class="content-div">
                
            </div>
        </section>

        
        
        <article class="card">
            <div class="card-header">
                <h2 class="card-title">Metodika</h2>
            </div>
            <div class="card-body">
                <p>
                    Využívame voľne dostupné dáta z programu Copernicus (satelity Sentinel-2, L2A). Pre každý zvolený rok a obdobie sa stiahnu snímky s najnižšou oblačnosťou. Z pásiem B8 (blízke infračervené) a B4 (červené) sa vypočíta NDVI, ktorý je dobrým indikátorom množstva a zdravia vegetácie. Následne sa pomocou lineárnej regresie vypočíta trend pre každý pixel na mape.
                </p>
                <p>
                    Výsledkom je mapa, kde <strong>zelená farba</strong> indikuje pribúdanie vegetácie (potenciálne viac alergénov), <strong>červená</strong> úbytok a <strong>biela</strong> stabilný stav.
                </p>
            </div>
        </article>
    </main>
</div>

<script>
    function loadVegetaciu(contentDiv) {
        contentDiv.innerHTML = `
        <h1 class="hero-title">Ako sa mení vegetácia počas peľových sezón?</h1>
                <p class="hero-subtitle">
                    Zvoľte si roky a peľovú sezónu pre analýzu. Nástroj vyhodnotí zeleň (NDVI) v danom období a porovná jej vývoj naprieč rokmi, čo môže pomôcť identifikovať zmeny v intenzite peľových alergénov.
                </p>

                <div class="hero-controls">
                    <div class="control-group">
                        <label for="year-select">Vyberte roky (aspoň dva)</label>
                        <div id="year-checkbox-container" class="year-checkbox-group">
                            <!-- Checkboxy rokov budú dynamicky vložené cez JS -->
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="season-select">Peľová sezóna</label>
                        <div class="control-input">
                            <select id="season-select">
                                <option value="early_spring">Skorá jar (Feb-Mar)</option>
                                <option value="mid_spring">Stredná jar (Apr-Máj)</option>
                                <option value="late_spring" selected>Neskorá jar / Leto (Jún-Aug)</option>
                                <option value="year">Celý rok</option>
                            </select>
                        </div>
                        <div id="season-info"></div>
                    </div>
                    <div class="control-group button-group">
                        <label>&nbsp;</label>
                        <button class="primary" id="analyze-btn">Analyzovať trend</button>
                    </div>
                </div>
                <section id="results" class="results-section">
                    <div class="placeholder-text">Výsledná mapa trendu sa zobrazí tu.</div>
                </section>
        `;
    }

    function loadPollenSeason(contentDiv) {
        contentDiv.innerHTML = `
               <h1 class="hero-title">Nástup peľovej sezóny</h1>
                <p class="hero-subtitle">
                    Analyzujte zmeny vegetácie počas peľových sezón v Trnave v rôznych oblastiach. Vyberte roky, aby ste zistili, ako sa mení množstvo zelene, čo môže indikovať intenzitu peľových alergénov.
                </p>

                <div class="hero-controls">
                    <div class="control-group">
                        <label for="year-select">Vyberte rok</label>
                        <div id="year-checkbox-container" class="year-checkbox-group">
                            <!-- Checkboxy rokov budú dynamicky vložené cez JS -->
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="location-select">Nástup peľovej sezóny</label>
                        <div class="control-input">
                            <select id="location-select">
                                <option value="janka-krala">Park Janka Kráľa</option>
                                <option value="nemocnicny">Nemocničný park</option>
                                <option value="strky" selected>Štrky</option>
                                <option value="druzba">Park za družbou</option>
                                <option value="zahradkarska">Záhradkárska oblasť</option>
                                <option value="kamenac">Kamenáč</option>
                                <option value="rybniky">Rybníky</option>
                                </select>
                        </div>
                        <div id="season-info"></div>
                    </div>
                    <div class="control-group button-group">
                        <label>&nbsp;</label>
                        <button class="primary" id="analyze-btn">Zobraziť vývoj peľovej sezóny</button>
                    </div>
                </div>
                <section id="results" class="results-section">
                    <div class="placeholder-text">Výsledná mapa trendu sa zobrazí tu.</div>
                </section>`;
    }

        const content = document.querySelector('.content-div');
        loadVegetaciu(content);     
        
        const vegBtn = document.querySelector('.load-veg-btn');
        vegBtn.addEventListener('click', () => {
            loadVegetaciu(content);
            const yearContainer = document.getElementById('year-checkbox-container');
            populateYearCheckboxes(yearContainer);
        });    
        
        const pollenBtn = document.querySelector('.load-pollen-btn');
        pollenBtn.addEventListener('click', () => {
            loadPollenSeason(content);
            const yearContainer = document.getElementById('year-checkbox-container');
            populatePollenYearCheckboxes(yearContainer);
        });

        const yearContainer = document.getElementById('year-checkbox-container');
        const analyzeBtn = document.getElementById('analyze-btn');
        const seasonSelect = document.getElementById('season-select');
        const locationSelect = document.getElementById('location-select');
        const resultsSection = document.getElementById('results');
        const seasonInfo = document.getElementById('season-info');
        populateYearCheckboxes(yearContainer);

        const pollenInfo = {
            early_spring: "Hlavné alergény: Lieska, Jelša, Tis.",
            mid_spring: "Hlavné alergény: Javor, Jaseň, Bresty.",
            late_spring: "Hlavné alergény: Pagaštan, Lipa, trávy.",
            year: "Analýza pre celý kalendárny rok."
        };

        // Populácia rokov ako checkboxy
    function populateYearCheckboxes(yearContainer) {
        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= 2017; year--) {
            const div = document.createElement('div');
            div.className = 'year-checkbox';
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.id = `year-${year}`;
            input.value = year;
            // Predvolene vyberieme posledné dva roky
            if (year === currentYear || year === currentYear - 1) {
                input.checked = true;
            }
            const label = document.createElement('label');
            label.htmlFor = `year-${year}`;
            label.textContent = year;
            div.appendChild(input);
            div.appendChild(label);
            yearContainer.appendChild(div);
        }
    }

    function populatePollenYearCheckboxes(yearContainer) {
        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= 2020; year--) {
            const div = document.createElement('div');
            div.className = 'year-checkbox';
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.id = `year-${year}`;
            input.value = year;
            // Predvolene vyberieme aktuálny rok
            if (year === currentYear) {
                input.checked = true;
            }
            // Allow only one year to be selected
            input.addEventListener('change', function() {
                if (this.checked) {
                    yearContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                        if (cb !== this) cb.checked = false;
                    });
                }
            });
            const label = document.createElement('label');
            label.htmlFor = `year-${year}`;
            label.textContent = year;
            div.appendChild(input);
            div.appendChild(label);
            yearContainer.appendChild(div);
        }
    }
        
        function updateSeasonInfo() {
            const selectedSeason = seasonSelect.value;
            seasonInfo.textContent = pollenInfo[selectedSeason] || "";
        }

        async function handlePollenAnalysis() {
            const selectedYears = Array.from(yearContainer.querySelectorAll('input[type="checkbox"]:checked'))
                                     .map(cb => cb.value);
            const selectedLocation = locationSelect.value;

            if (selectedYears.length === 0) {
                showError("Vyberte prosím rok pre analýzu.");
                return;
            }

            
        }

        async function handleAnalysis() {
            const selectedYears = Array.from(yearContainer.querySelectorAll('input[type="checkbox"]:checked'))
                                     .map(cb => cb.value);
            const selectedSeason = seasonSelect.value;

            if (selectedYears.length < 2) {
                showError("Vyberte prosím aspoň dva roky pre analýzu trendu.");
                return;
            }

            showLoading();
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Spracúvam...';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        years: selectedYears,
                        season: selectedSeason,
                    }),
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || `HTTP error! Status: ${response.status}`);
                }
                showImage(data.image_url);
            } catch (error) {
                console.error('Analysis error:', error);
                showError(`Chyba pri analýze: ${error.message}`);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyzovať trend';
            }
        }
        
        function showLoading() {
            resultsSection.innerHTML = '<div class="spinner"></div><p class="placeholder-text" style="margin-top: 10px;">Prebieha analýza, môže to trvať aj viac ako minútu...</p>';
        }

        function showImage(imageUrl) {
            const url = `${imageUrl}?t=${new Date().getTime()}`;
            resultsSection.innerHTML = `<img src="${url}" alt="Mapa trendu vegetácie">`;
        }

        function showError(message) {
            resultsSection.innerHTML = `<div class="error-message">${message}</div>`;
        }
        
        analyzeBtn.addEventListener('click', handleAnalysis);
        seasonSelect.addEventListener('change', updateSeasonInfo);
        
        // Initial call
        updateSeasonInfo();
</script>
</body>
</html>


